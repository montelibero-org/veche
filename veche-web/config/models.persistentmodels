-- By default this file is used by `persistFileWith` in Model.hs (which is imported by Foundation.hs)
-- Syntax for this file here: https://github.com/yesodweb/persistent/blob/master/docs/Persistent-entity-syntax.md


Comment
    author  UserId
    created UTCTime
    message Text
    parent  CommentId Maybe
    issue   IssueId
    type    CommentType

    deriving Eq
    deriving Show


Event
    type        EventType
    time        UTCTime
    delivered   Bool
    issue       IssueId Maybe
    comment     CommentId Maybe

    deriving Eq
    deriving Show


Issue
    author      UserId
    open        Bool
    title       Text

    -- denormalized fields to avoid extra requests
    created     UTCTime -- Must be equal to min version.created.
    curVersion  IssueVersionId Maybe    -- Must be equal to max version.
                                        -- Must be Just after creation.
                                        -- May be Nothing only during creation.
    approval    Double  default=0   -- Share of 'approve' votes.
                                    -- Must be recalculated every time somebody
                                    -- votes or the set of voters is changed.
    commentNum  Int     default=0   -- Number of text comments.
                                    -- Must be recalculated on every
                                    -- addition/removal of text comments.

    deriving Eq
    deriving Show


IssueVersion
    author  UserId
    body    Text
    created UTCTime
    issue   IssueId


Request
    user        UserId
    comment     CommentId
    fulfilled   Bool
    issue       IssueId -- denormalized; request.issue == request.comment->issue
    delivered   Bool    -- Request is also a kind of Event

    UniqueRequest user comment

    deriving Eq
    deriving Show


StellarHolder
    asset   Asset
    key     Stellar.Address -- holder account address

    UniqueHolder asset key


StellarSigner
    target  StellarMultiSigAddress  -- target account address (managed one)
    key     Stellar.Address         -- signer account address
    weight  Int

    UniqueSigner target key sql=UniqueMember

    deriving Show


User
    name            Text Maybe
    stellarAddress  Stellar.Address

    UniqueUser stellarAddress

    deriving Eq
    deriving Show


Telegram
    Id          UserId
    chatid      Int64   -- unique, but we don't want to enforce it
    username    Text    -- unique, but we don't want to enforce it

    deriving Eq
    deriving Show


Verifier
    userIdent   Stellar.Address
    key         Text
    expires     UTCTime

    UniqueVerifier userIdent key


Vote
    user    UserId
    issue   IssueId
    choice  Choice

    UniqueVote user issue

    deriving Show
